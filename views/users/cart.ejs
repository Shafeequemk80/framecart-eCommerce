<%- include("../layouts/header.ejs")%>

<div class="page-wrapper">
  <%- include("../layouts/userNavbar.ejs")%>

  <main class="main">
    <div
      class="page-header text-center"
      style="background-image: url('/static/assets/images/page-header-bg.jpg')"
    >
      <div class="container">
        <h1 class="page-title">Shopping Cart<span>Shop</span></h1>
      </div>
      <!-- End .container -->
    </div>
    <!-- End .page-header -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav">
      <div class="container">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item"><a href="#">Shop</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            Shopping Cart
          </li>
        </ol>
      </div>
      <!-- End .container -->
    </nav>
    <!-- End .breadcrumb-nav -->

    <div class="page-content">
      <div class="cart">
        <div class="container">
          <div class="row">
            <div class="col-lg-9">
              <table class=" border table table-cart table-mobile">
                <thead>
                  <tr>
                    <th class>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th></th>
                  </tr>
                </thead>

                <tbody>
                  <%if(cartData){if(cartData.products[0]) {for(var i=0;i<
                  cartData.products.length;i++){%>
                  <tr>
                    <td class="product-col">
                      <div class="product">
                        <figure class="product-media">
                          <a href="/product?id=<%= cartData.products[i].product._id %>">
                            <img
                              src="/static/produtsImages/<%= cartData.products[i].product.images[0] %>"
                              alt="Product image"
                            />
                          </a>
                        </figure>

                        <h3 class="product-title">
                          <a href="/product?id=<%= cartData.products[i].product._id %>"
                            ><%= cartData.products[i].product.productname %></a
                          >
                        </h3>
                        <!-- End .product-title -->
                      </div>
                      <!-- End .product -->
                    </td>

                    <td class="price-col">
                      <%= cartData.products[i].product.price %>
                    </td>
                    <td class="quantity-col">
                      <div class="cart-product-quantity">
                        <form
                          id="countForm"
                          action="/actionincart"
                          method="post"
                        >
                          <input
                            type="number"
                            name="count"
                            class="form-control"
                            value="<%=cartData.products[i].count%>"
                            min="1"
                            max="10"
                            step="1"
                            required
                          />
                          <input
                            type="hidden"
                            name="product_id"
                            value="<%=cartData.products[i].product._id%>"
                          />
                        </form>
                      </div>
                      <!-- End .cart-product-quantity -->
                    </td>
                    <td class="total-col">
                      <%=cartData.products[i].totalprice%>
                    </td>
                   
                    
                      <td class="remove-col">
                        <a
                        href="/deletefromcart?id=<%=cartData.products[i].product._id%>&count=<%=cartData.products[i].count%>"<button class="btn-remove">
                          <i class="icon-close"></i>
                        </button></a></td
                    >
                  </tr>
                </tbody>
                  <%}}}else{%>
          
                     <th><h3 class="d-flex justify-content-center">No items in cart</h3></th>
                
                    
                
                  <%}%>
                
              </table>
                           
            
              <!-- End .table table-wishlist --
              <!-- End .cart-bottom -->
            </div>
            <!-- End .col-lg-9 -->
            <aside class="col-lg-3">
              <div class="summary summary-cart">
                <h3 class="summary-title">Cart Total</h3>
                <!-- End .summary-title -->

                <table class="table table-summary">
                  <tbody>
                    <tr class="summary-subtotal">
                      <td>Subtotal:</td>
                      <td><%=cartData.ammount%></td>
                    </tr>
                    <!-- End .summary-subtotal -->
                    <tr class="summary-shipping">
                      <td>Shipping:</td>
                      <td>&nbsp;</td>
                    </tr>

                    <tr class="summary-shipping-estimate">
                      <td>
                        Estimate for Your Country<br />
                        <a href="dashboard.html">Change address</a>
                      </td>
                      <td>&nbsp;</td>
                    </tr>
                    <!-- End .summary-shipping-estimate -->

                    <tr class="summary-total">
                      <td>Total:</td>
                      <td>$160.00</td>
                    </tr>
                    <!-- End .summary-total -->
                  </tbody>
                </table>
                <!-- End .table table-summary -->

                <a
                  href="checkout.html"
                  class="btn btn-outline-primary-2 btn-order btn-block"
                  >PROCEED TO CHECKOUT</a
                >
              </div>
              <!-- End .summary -->

              <a
                href="category.html"
                class="btn btn-outline-dark-2 btn-block mb-3"
                ><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i
              ></a>
            </aside>
            <!-- End .col-lg-3 -->
          </div>
          <!-- End .row -->
        </div>
        <!-- End .container -->
      </div>
      <!-- End .cart -->
    </div>
    <!-- End .page-content -->
  </main>
  <!-- End .main -->
  <%- include("../layouts/userFooter.ejs")%>
  
  
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="path/to/inputSpinnerPlugin.js"></script>
  
  <script>
    $(document).ready(function () {
      function quantityInputs() {
        if ($.fn.inputSpinner) {
          $("input[type='number']").inputSpinner({
            decrementButton: '<i class="icon-minus"></i>',
            incrementButton: '<i class="icon-plus"></i>',
            groupClass: "input-spinner",
            buttonsClass: "btn-spinner",
            buttonsWidth: "26px",
          });
        }
  
        $(".btn-spinner").on("click", function (event) {
          event.preventDefault();
  
          var form = $(this).closest("form");
          var formData = new FormData(form[0]);
  
          // Submit the form using fetch
          fetch(form.attr("action"), {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams(formData).toString(),
          })
            .then((response) => response.json())
            .then((updatedCartData) => {
              updateCart(updatedCartData);
            })
            .catch((error) => {
              console.error("Fetch error:", error);
            });
        });
      }
  
      function updateCart(updatedCartData) {
        var cartBody = $(".cart tbody");
  
        if (updatedCartData && updatedCartData.products) {
          cartBody.html(""); // Clear existing cart content
  
          var subtotal = 0;
  
          for (var i = 0; i < updatedCartData.products.length; i++) {
            cartBody.append(
              `<tr>
                <td class="product-col">
                  <div class="product">
                    <!-- ... (existing HTML) ... -->
                  </div>
                </td>
                <td class="price-col">${updatedCartData.products[i].product.price}</td>
                <td class="quantity-col">
                  <!-- ... (existing HTML) ... -->
                </td>
                <td class="total-col">${updatedCartData.products[i].totalprice}</td>
                <td class="remove-col">
                  <a href="/deletefromcart?id=${updatedCartData.products[i].product._id}&count=${updatedCartData.products[i].count}" class="btn-remove">
                    <i class="icon-close"></i>
                  </a>
                </td>
              </tr>`
            );
  
            subtotal += updatedCartData.products[i].totalprice;
          }
  
          $(".summary-subtotal td:last-child").text(subtotal);
          $(".summary-total td:last-child").text(subtotal); // Assuming total is the same as subtotal in this case
        } else {
          cartBody.append(`<tr><th colspan="5">No items in cart</th></tr>`);
        }
      }
  
      quantityInputs();
    });
  </script>
  
  
  <%- include("../layouts/footer.ejs")%>
</div>
